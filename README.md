## 文档向量化服务 doc-feature

### 一、项目贡献
1. 基于企鹅号自媒体发布的 1000 多万篇中文文章语料，利用 CBOW 训练 word2vec 模型，得到 300 维的词向量；
2. 基于 Flask 框架提供一个简单的抽取文档向量的服务；

### 二、模型训练
1. 本次训练使用参数

| 参数名 | 取值 | 
| - | :-: | 
| size | 300 |
| window | 5 |
| min_count | 3 |
| sg | 0 |

2. 参数含义
- size: 指定词向量的维度
- window: 指定句子中当前词语和待预测词语之间的最大距离
- min_count: 指定最小词频，忽略语料中总出现次数低于该值的词语
- sg: 指定训练算法，1 表示 "skip-gram"，0 表示 " CBOW"

3. 使用示例
  1) 设置 locale ，在终端正确输入中文字符， ```export LANG=zh_CN.UTF-8```

  2) 载入 word2vec 模型
     ![载入模型](example_imgs/0.png)
     
  3) 示例
     ![示例1](example_imgs/1.png)
     
     ![示例2](example_imgs/2.png)

### 三、文档向量化服务
1. 在目录 vec_server 中，提供了一个简单的利用 word2vec 抽取文档向量的 HTTP 服务
2. 基于 Flask 框架，只支持 POST 请求：
   - 参数名 ```doc```，输入为英文空格分割的文档词语列表；
   - 响应内容为 JSON 格式，其中```result``` 字段表示 300 维的向量；
3. CURL 请求示例
```json
curl -XPOST -d 'doc=王丹妮 黑龙江省 绥化市 宝山镇 患有 白血病 年 花 43 万 钱治空 房子 卖 写下 死亡 日记 记录 抗 癌 经历 月 15 号 11 岁 生日 写道 祈求 死神 早日 带走 无钱 医治 真的 太 痛苦 月前 乙图 故事 关注 网友 高度 关注 一位 好心 神秘 人一次 捐赠 22 万 医疗费 图为 回到  北京 治疗 丹妮h 'http://host:ip/vectorize'
{"code":0,"cost":0.06671547889709473,"msg":"success","result":[0.06986404210329056,-0.025921275839209557,0.005782345309853554,-0.009622079320251942,-0.03922620788216591,-0.0014051459729671478,0.01044031884521246,0.03565274924039841,-0.010186812840402126,-0.019532280042767525,0.032928887754678726,-0.03158945217728615,0.010625342838466167,-0.01732414960861206,0.0012895675608888268,0.06734472513198853,-0.010603123344480991,0.01590937376022339,-0.004669148940593004,0.05468551442027092,-0.007239328697323799,-0.06430743634700775,0.006551005411893129,-0.030658058822155,-0.036109790205955505,0.032925620675086975,0.0004224451258778572,0.024198876693844795,0.02933945320546627,0.04601554572582245,0.06440083682537079,0.10548426955938339,-0.013840007595717907,0.04290442168712616,0.019229700788855553,0.07117987424135208,-0.002075399039313197,-0.022042378783226013,-0.008296764455735683,0.005781311076134443,-0.018091779202222824,-0.023217618465423584,0.01706337369978428,-0.012788076885044575,-0.024935759603977203,-0.014396563172340393,-0.027160165831446648,0.0011367601109668612,-0.017326118424534798,-0.055791597813367844,-0.05865928530693054,0.010514207184314728,-0.015202857553958893,-0.07120974361896515,0.023113012313842773,-0.018280649557709694,-0.033763282001018524,-0.04931887984275818,-0.025079408660531044,0.12181740254163742,0.025553449988365173,0.011600032448768616,-0.02531179040670395,0.02055344171822071,-0.03179904446005821,0.08454398065805435,0.005491210147738457,0.0037470341194421053,-0.008412995375692844,-0.05357934534549713,0.020968154072761536,-0.02916461043059826,-0.02676820009946823,0.01548140961676836,0.022525230422616005,-0.01962156407535076,0.015191844664514065,-0.027918638661503792,0.050970982760190964,0.00265815039165318,-0.04645565152168274,0.025712311267852783,0.0001924441457958892,0.03678365424275398,0.0037714624777436256,-0.0006182214710861444,-0.042563240975141525,0.03931528702378273,-0.0011027384316548705,-0.0084136463701725,-0.008944560773670673,-0.05197219178080559,-0.01978468708693981,-0.039568882435560226,-3.149771828248049e-06,0.0053620971739292145,0.007755993399769068,-0.012898306362330914,-0.01949416473507881,0.019041702151298523,0.04956236854195595,-0.037792980670928955,-0.012852046638727188,0.014978309161961079,0.009782014414668083,0.040716201066970825,-0.06198165938258171,-0.0057383389212191105,-0.08673916012048721,0.012006704695522785,0.039500221610069275,0.06991562992334366,-0.028360718861222267,0.02268795855343342,-0.01661740243434906,-0.048511967062950134,0.05533890426158905,0.07531295716762543,-0.08033513277769089,0.028746532276272774,-0.059110384434461594,0.0005870761233381927,0.015275925397872925,-0.0559585802257061,0.03081820346415043,0.02265302836894989,-0.01677877828478813,0.059169668704271317,-0.035133589059114456,0.005453158635646105,-0.01940704882144928,0.058185432106256485,0.0047154612839221954,0.0006495360285043716,0.046866703778505325,-0.02529393881559372,-0.025744637474417686,-0.058204084634780884,-0.029089368879795074,0.014185421168804169,0.014565925113856792,0.003156730905175209,-0.026938116177916527,0.004247650969773531,-0.0146288787946105,-0.01781727932393551,0.014342691749334335,-0.004002029076218605,-0.04846857860684395,-0.027009958401322365,0.07457952946424484,-0.00926930084824562,-0.10780636221170425,0.016184285283088684,0.05173207446932793,0.027695966884493828,0.04548696056008339,-0.009127652272582054,0.026199890300631523,-0.055247962474823,0.01771370694041252,-0.020119475200772285,0.029138080775737762,-0.028451966121792793,-0.016691962257027626,0.009577911347150803,0.044151317328214645,-0.009702417068183422,0.07244957238435745,0.04172798618674278,0.020038800314068794,-0.008674158714711666,0.030055010691285133,-0.0012364359572529793,0.022013666108250618,0.07524053752422333,0.012277941219508648,-0.036755505949258804,-0.03523387387394905,0.0013298863777890801,0.05657269060611725,0.004144982900470495,-0.01024092361330986,0.11423920840024948,0.006189223378896713,0.032897304743528366,-0.02777368389070034,-0.019186565652489662,-0.006775617599487305,0.028449228033423424,0.010434920899569988,-0.026680022478103638,-0.023438459262251854,-0.02771499566733837,-0.043144237250089645,0.06394468992948532,-0.034709300845861435,0.005381719674915075,0.009775974787771702,-0.01953999698162079,0.02342679165303707,0.017962899059057236,-0.047273796051740646,0.0066289096139371395,-0.0025840196758508682,0.08380886912345886,-0.0349007211625576,-0.033468421548604965,0.024543175473809242,-0.042262881994247437,0.025023408234119415,0.001618652488104999,0.02583231031894684,-0.05623127520084381,-0.008559049107134342,0.043208491057157516,-0.008329248987138271,-0.04226354882121086,0.03250153735280037,0.05354587361216545,0.00428587244823575,-0.02524050511419773,-0.07287714630365372,-0.005446350667625666,-0.01677149161696434,0.02330840565264225,-0.010666507296264172,0.0464622862637043,-0.029896622523665428,0.012979123741388321,-0.032670989632606506,-0.05472831800580025,0.029033446684479713,-0.09015247225761414,0.006629719864577055,0.01866110973060131,-0.013648529537022114,0.03213712200522423,0.05719968304038048,-0.021039286628365517,-0.008537611924111843,0.05245094373822212,-0.04786508157849312,-0.01700711064040661,0.01318354532122612,0.054048091173172,-0.007470342796295881,0.049982715398073196,0.017004022374749184,0.005434533581137657,-0.04534165933728218,-0.06288252025842667,-0.05043652653694153,0.04475956782698631,0.04635877534747124,-0.03845459595322609,-0.011501838453114033,-0.03597879782319069,0.003226885572075844,0.05220150575041771,-0.06874638795852661,0.03051188588142395,-0.023312121629714966,-0.019740426912903786,-0.04814266785979271,0.05489663779735565,-0.01142684742808342,0.02873791940510273,-0.005462767090648413,0.01602400839328766,-0.05014583840966225,-0.03279118239879608,-0.005887225270271301,0.11487960070371628,0.0011212117969989777,0.02198231779038906,0.005451485980302095,-0.018270136788487434,-0.053277309983968735,-0.04522988572716713,-0.0152415307238698,-0.06267129629850388,0.02501136064529419,0.053839754313230515,-0.05873258411884308,0.06686703115701675,-0.004676429089158773,-0.003963926807045937,-0.045164406299591064,-0.04145047441124916,0.025080343708395958,-0.06512241810560226,-0.021272851154208183,-0.05456304922699928,-0.07314305752515793,0.014525778591632843,-0.04477754235267639,0.028701767325401306,-0.0008017265354283154,0.022637011483311653]}
```

### 四、参考
1. [word2vec 模型微云下载](https://share.weiyun.com/5MMqj97)
2. [gensim.models.word2vec.Word2Vec 类说明文档](https://radimrehurek.com/gensim/models/word2vec.html#gensim.models.word2vec.Word2Vec)
